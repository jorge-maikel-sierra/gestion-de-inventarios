<%- include('../partials/header') %>

<div class="page-header">
  <div>
    <nav class="breadcrumb">
      <a href="/categories">CategorÃ­as</a>
      <span>â€º</span>
      <span><%= category.name %></span>
    </nav>
    <h1 class="page-title">ğŸ¸ <%= category.name %></h1>
    <p class="page-subtitle"><%= category.description || 'Sin descripciÃ³n.' %></p>
  </div>
  <div class="btn-group">
    <a href="/categories/<%= category.id %>/edit" class="btn btn-secondary">âœï¸ Editar</a>
    <a href="/items/new?category_id=<%= category.id %>" class="btn btn-primary">+ Nuevo Producto</a>
  </div>
</div>

<!-- â”€â”€â”€â”€ STATS â”€â”€â”€â”€ -->
<div class="stats-row">
  <div class="stat-card">
    <span class="stat-number"><%= category.item_count %></span>
    <span class="stat-label">Productos</span>
  </div>
</div>

<!-- â”€â”€â”€â”€ TABLA DE ITEMS â”€â”€â”€â”€ -->
<div class="card">
  <div class="card-header">
    <h2>Productos en esta categorÃ­a</h2>
    <a href="/items/new?category_id=<%= category.id %>" class="btn btn-sm btn-primary">+ Agregar</a>
  </div>
  <% if (items.length === 0) { %>
    <div class="empty-state-inline">
      <p>ğŸ“­ No hay productos en esta categorÃ­a todavÃ­a.</p>
      <a href="/items/new?category_id=<%= category.id %>" class="btn btn-primary">Agregar primer producto</a>
    </div>
  <% } else { %>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Precio</th>
            <th>Stock</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% items.forEach(item => { %>
            <tr>
              <td>
                <a href="/items/<%= item.id %>" class="item-link"><%= item.name %></a>
                <% if (item.description) { %>
                  <small class="item-desc"><%= item.description.substring(0, 60) %><%= item.description.length > 60 ? '...' : '' %></small>
                <% } %>
              </td>
              <td class="price-cell">$<%= parseFloat(item.price).toFixed(2) %></td>
              <td>
                <span class="stock-badge <%= item.quantity === 0 ? 'stock-empty' : item.quantity < 5 ? 'stock-low' : 'stock-ok' %>">
                  <%= item.quantity %>
                </span>
              </td>
              <td class="actions-cell">
                <a href="/items/<%= item.id %>" class="btn btn-xs btn-outline">Ver</a>
                <a href="/items/<%= item.id %>/edit" class="btn btn-xs btn-secondary">Editar</a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</div>

<!-- â”€â”€â”€â”€ ZONA DE PELIGRO â”€â”€â”€â”€ -->
<div class="danger-zone">
  <h3>âš ï¸ Zona de Peligro</h3>
  <p>Eliminar esta categorÃ­a es una acciÃ³n permanente. Solo es posible si no tiene productos asociados.</p>

  <button class="btn btn-danger" onclick="document.getElementById('delete-modal').style.display='flex'">
    ğŸ—‘ï¸ Eliminar CategorÃ­a
  </button>
</div>

<!-- â”€â”€â”€â”€ MODAL ELIMINAR â”€â”€â”€â”€ -->
<div id="delete-modal" class="modal-overlay" style="display:none;">
  <div class="modal">
    <h3>ğŸ—‘ï¸ Confirmar eliminaciÃ³n</h3>
    <p>EstÃ¡s a punto de eliminar la categorÃ­a <strong>"<%= category.name %>"</strong>.</p>
    <p class="modal-warning">âš ï¸ Esta acciÃ³n no se puede deshacer. Requiere contraseÃ±a de administrador.</p>

    <form action="/categories/<%= category.id %>?_method=DELETE" method="POST">
      <div class="form-group">
        <label class="form-label" for="delete-admin-pass">ContraseÃ±a de Administrador</label>
        <input
          type="password"
          id="delete-admin-pass"
          name="admin_password"
          class="form-control"
          placeholder="Ingresa la contraseÃ±a..."
          required
          autocomplete="off"
        />
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-outline" onclick="document.getElementById('delete-modal').style.display='none'">
          Cancelar
        </button>
        <button type="submit" class="btn btn-danger">Confirmar EliminaciÃ³n</button>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/footer') %>
